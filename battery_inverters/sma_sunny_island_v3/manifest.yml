blueprint_spec: device/3.0

display_name: SMA Sunny Island
description: SMA Sunny Island battery inverter.
icon: enapter-inverter-battery
license: MIT
author: enapter
contributors:
  - anataty
  - nikitug
support:
  url: https://go.enapter.com/enapter-blueprint-support
  email: support@enapter.com

implements:
  - energy.battery_inverter.3_phase
  - lib.energy.battery.temperature
  - lib.energy.battery.soh
  - lib.energy.inverter.residual_current
  - lib.energy.power_quality.power_factor.totals

runtime:
  type: lua
  requirements:
    - modbus
  options:
    dir: src

configuration:
  connection:
    display_name: Connection
    description: Modbus TCP connection options
    access_level: owner
    parameters:
      address:
        display_name: Modbus Address
        description: Hostname and port, e.g. 192.168.14.45:502
        type: string
        required: true
      unit_id:
        display_name: Modbus Unit ID
        description: Can be obtained from SMA web interface, default is 3
        type: integer
        required: true

properties:
  vendor:
    display_name: Vendor
    type: string
  model:
    display_name: Model
    type: string
  serial_number:
    display_name: Serial Number
    type: string
  firmware_version:
    display_name: Firmware Version
    type: string
  inverter_nameplate_capacity:
    display_name: Rated Power
    type: integer
    unit: VA
  grid_mode:
    display_name: Grid Mode
    type: string
  battery_type:
    display_name: Battery Type
    type: string
    enum:
      - lead_based
      - lithium_based
      - nickel_based
      - flow
      - sodium_based
      - other
  battery_nameplate_capacity:
    display_name: Battery Nameplate Capacity
    type: float
    unit: Wh
  country_code:
    display_name: Country Code
    type: string
  address:
    display_name: Modbus Address
    type: string
  unit_id:
    display_name: Modbus Unit ID
    type: integer

telemetry:
  status:
    display_name: Status
    type: string
    description: Current operational status of the inverter
    enum:
      "off":
        display_name: "Off"
        color: purple-lighter
        description: Inverter is switched off
      standby:
        display_name: Standby
        color: blue
        description: >
          Inverter is in standby mode waiting for startup conditions.
      starting:
        display_name: Starting
        color: pink-light
        description: Inverter is going through startup procedure
      operating:
        display_name: Operating
        color: cyan
        description: Inverter is actively operating
      shutting_down:
        display_name: Shutting Down
        color: pink-light
        description: Inverter is going through shutdown procedure
      fault:
        display_name: Fault
        color: red
        description: Inverter has detected a fault and is not operating
  health:
    display_name: Health Status
    type: string
    enum:
      - ok
      - warning
      - fault
  operating_status:
    display_name: Operating Status
    type: string
    enum:
      - standby
      - fault
      - waiting_pv_voltage
      - start
      - shutdown
      - waiting_utilities
      - bolted
      - standalone
      - derating
      - mpp
      - "off"
      - stop
      - const_voltage
      - warning
      - run
  recom_action:
    display_name: Recommended Action
    type: string
    enum:
      - ok
      - contact_manufacturer
      - contact_installer
  derating_reason:
    display_name: Derating Reason
    type: string
    enum:
      - ok
      - frequency_deviation
      - voltage_deviation
      - reactive_power_priority
      - high_dc_voltage
      - external_setting
      - external_setting_2
      - overtemperature
  grid_relay_closed:
    display_name: Grid Relay Closed
    type: boolean
  grid_total_power:
    display_name: Grid Total Power
    type: float
    unit: W
  battery_soc:
    display_name: Battery State of Charge
    type: float
    unit: "%"
  battery_soh:
    display_name: Battery State of Health
    type: float
    unit: "%"
  battery_voltage:
    display_name: Battery Voltage
    type: float
    unit: V
  battery_current:
    display_name: Battery Current
    type: float
    unit: A
  battery_power:
    display_name: Battery Power
    type: float
    unit: W
  battery_temperature:
    display_name: Battery Temperature
    type: float
    unit: Cel
  ac_total_power:
    display_name: AC Total Power
    type: float
    unit: W
  ac_frequency:
    display_name: AC Frequency
    type: float
    unit: Hz
  ac_l1_power:
    display_name: AC L1 Power
    type: float
    unit: W
  ac_l2_power:
    display_name: AC L2 Power
    type: float
    unit: W
  ac_l3_power:
    display_name: AC L3 Power
    type: float
    unit: W
  ac_l1_voltage:
    display_name: AC L1 Voltage
    type: float
    unit: V
  ac_l2_voltage:
    display_name: AC L2 Voltage
    type: float
    unit: V
  ac_l3_voltage:
    display_name: AC L3 Voltage
    type: float
    unit: V
  ac_l1_current:
    display_name: AC L1 Current
    type: float
    unit: A
  ac_l2_current:
    display_name: AC L2 Current
    type: float
    unit: A
  ac_l3_current:
    display_name: AC L3 Current
    type: float
    unit: A
  ac_power_reactive:
    display_name: AC Reactive Power
    type: float
    unit: VAR
    implements: lib.energy.power_quality.power_factor.totals.ac_total_power_reactive
  ac_power_apparent:
    display_name: AC Apparent Power
    type: float
    unit: VA
    implements: lib.energy.power_quality.power_factor.totals.ac_total_power_apparent
  ac_power_factor:
    display_name: AC Power Factor
    type: float
  residual_current:
    display_name: Residual Current
    type: float
    unit: A
    implements: lib.energy.inverter.residual_current.inverter_residual_current
  internal_temperature:
    display_name: Internal Temperature
    type: float
    unit: Cel
  load_power:
    display_name: Load Power
    type: float
    unit: W
    implements: energy.battery_inverter.3_phase.load_total_power
  ac_l1_power_reactive:
    display_name: AC L1 Reactive Power
    type: float
    unit: VAR
  ac_l2_power_reactive:
    display_name: AC L2 Reactive Power
    type: float
    unit: VAR
  ac_l3_power_reactive:
    display_name: AC L3 Reactive Power
    type: float
    unit: VAR
  ac_l1_power_apparent:
    display_name: AC L1 Apparent Power
    type: float
    unit: VA
  ac_l2_power_apparent:
    display_name: AC L2 Apparent Power
    type: float
    unit: VA
  ac_l3_power_apparent:
    display_name: AC L3 Apparent Power
    type: float
    unit: VA
  ac_l1_power_factor:
    display_name: AC L1 Power Factor
    type: float
  ac_l2_power_factor:
    display_name: AC L2 Power Factor
    type: float
  ac_l3_power_factor:
    display_name: AC L3 Power Factor
    type: float
  conn_alerts:
    display_name: Connection Alerts
    description: Alerts indicating connection and configuration issues.
    type: alerts

# yamllint disable rule:line-length
alerts:
  not_configured:
    severity: info
    display_name: Not Configured
    description: >
      Device not set up. Go to Configuration to connect.
  communication_failed:
    display_name: Communication Failed
    severity: error
    description: Connection to the device has failed.
    grace_period: 15s
    troubleshooting:
      - Double check the physical connection.
      - Ensure that Modbus address is the same as in your device.
      - >
        Ensure that the UCM's hardware configuration matches your
        device's connection configuration.
  unknown_event:
    display_name: Unknown Event
    severity: error
    description: >
      Inverter should have returned message code, but it did not.
      Operation.Evt.Msg (30213) does not equal to NoneMsg (886).
  volt_high:
    severity: error
    display_name: Voltage Too High
    description: >
      The voltage of the generator or of the utility grid of the
      Sunny Island is too high.
    troubleshooting:
      - Check the grid voltage at the connection point.
      - Ensure that the correct country data set has been configured.
  volt_low:
    severity: error
    display_name: Voltage Too Low
    description: >
      The voltage of the generator or of the utility grid of the
      Sunny Island is too low.
    troubleshooting:
      - Check the grid voltage at the connection point.
      - Ensure that the correct country data set has been configured.
  rise_in_volt_protection:
    severity: error
    display_name: Rise-in-voltage Protection
    description: Rise-in-voltage protection has been triggered.
    troubleshooting:
      - Ensure that the conductor cross-section of the AC cables is correctly sized.
  external_grid_disconnect:
    severity: error
    display_name: External Grid Disconnection
    description: >
      Unintended stand-alone grid is present at connection AC2
      of the Sunny Island.
    troubleshooting:
      - Check the external grid connection.
  freq_too_low:
    severity: error
    display_name: Frequency Too Low
    description: >
      The frequency of the generator or the utility grid of the
      Sunny Island is too low.
    troubleshooting:
      - Check the grid frequency.
      - Ensure that the correct country data set has been configured.
  freq_too_high:
    severity: error
    display_name: Frequency Too High
    description: >
      The frequency of the generator or the utility grid of the
      Sunny Island is too high.
    troubleshooting:
      - Check the grid frequency.
      - Ensure that the correct country data set has been configured.
  grid_incident:
    severity: error
    display_name: Voltage and/or Frequency Out of Range
    description: >
      The voltage and/or frequency of the generator or the utility grid
      is/are outside of the configured range.
    troubleshooting:
      - Check grid voltage and frequency.
      - Ensure that the correct country data set has been configured.
  grid_connect_install_error:
    severity: error
    display_name: Grid Connection Installation Error
    description: >
      Ensure that the master is connected to L1, slave 1 is connected to L2,
      and slave 2 is connected to L3.
    troubleshooting:
      - Verify phase assignments for master and slave devices.
  volt_redundant_measure:
    severity: error
    display_name: Voltage is Outside Configured Thresholds
    description: >
      The voltage of the generator or the utility grid at the Sunny Island
      is outside the configured thresholds.
    troubleshooting:
      - Check the grid voltage at the connection point.
  ratio_high:
    severity: error
    display_name: AC Voltage and Battery Voltage Ratio Too High
    description: >
      The Sunny Island disconnects from the external energy source because the
      ratio of AC voltage and battery voltage is too high.
    troubleshooting:
      - Check if the voltage at connection AC2 is too high.
      - Check if the battery voltage is too low.
  line_conduct_disconnect:
    severity: error
    display_name: Sunny Island Disconnection
    description: >
      The Sunny Island disconnects from the utility grid due to phase conductor
      failure/overload at terminal AC2.
    troubleshooting:
      - Check the AC2 terminal connections.
  short_circuit:
    severity: error
    display_name: Short Circuit
    description: >
      A short circuit is present at connection AC2 of the Sunny Island.
    troubleshooting:
      - Check for short circuits at connection AC2.
  volt_freq_ratio_fault:
    severity: error
    display_name: Non-Compliance with Voltage-Frequency Ratio
    description: >
      Disconnection from the utility grid due to non-compliance with the
      voltage-frequency ratio.
    troubleshooting:
      - Check voltage and frequency at the connection point.
  gen_reverse_pow_fault:
    severity: error
    display_name: Generator Exceeded Reverse Power
    description: >
      AC sources in the system are driving the generator.
      The reverse power in the generator has been exceeded for too long.
    troubleshooting:
      - Check AC sources in the system.
      - Verify generator configuration.
  prohibited_feedback:
    severity: error
    display_name: Prohibited Feedback
    description: >
      The Sunny Island disconnects from the utility grid due to
      prohibited feedback.
    troubleshooting:
      - Check the feedback protection settings.
  high_feed_in_current:
    severity: error
    display_name: High Feed-in Current
    description: >
      The feed-in current is higher than the set maximum value.
    troubleshooting:
      - Check the 'Maximum current from utility grid' parameter.
  high_external_current:
    severity: error
    display_name: High External Current
    description: >
      The external current is greater than the permissible maximum current.
    troubleshooting:
      - Check the 'Maximum current from utility grid' or 'Nominal generator current' parameters.
  open_pre_fuse:
    severity: error
    display_name: Open Pre-Fuse
    description: >
      The pre-fuse F104.1, F104.2 or F104.3 in the Multicluster-Box is open.
    troubleshooting:
      - Check and replace the pre-fuse if necessary.
  phase_position_no_match:
    severity: error
    display_name: Phase Position Does not Match
    description: >
      Phase position of the measured AC voltage at ExtVtg and AC2 does not match.
    troubleshooting:
      - Verify phase assignments.
  tie_switch_no_close:
    severity: error
    display_name: Tie Switch Does Not Close
    description: >
      Ensure that the tie switch is correctly wired, its triggering is correct
      or feedback contact is correctly connected.
    troubleshooting:
      - Check tie switch wiring and feedback contact.
  line_conduct_volt_imbalance:
    severity: error
    display_name: Voltage Imbalance Between Line Conductors
    description: >
      The Sunny Island system disconnects from the generator or utility grid
      due to voltage imbalance between the line conductors.
    troubleshooting:
      - Check for voltage imbalance between phases.
  auto_gen_start:
    severity: warning
    display_name: Automatic Generator Start
    description: Automatic generator start due to set criteria, e.g. battery state of charge.
  auto_gen_stop:
    severity: warning
    display_name: Automatic Generator Stop
    description: Automatic generator stop due to set criteria, e.g. battery state of charge.
  manual_gen_start:
    severity: warning
    display_name: Manual Generator Start
    description: Manual generator start.
  manual_gen_stop:
    severity: warning
    display_name: Manual Generator Stop
    description: Manual generator stop.
  manual_gen_err:
    severity: error
    display_name: Manual Error Acknowledgment
    description: Manual error acknowledgment of generator error.
  gen_requested:
    severity: error
    display_name: Generator Requested
    description: Generator requested.
  gen_started:
    severity: info
    display_name: Generator Started
    description: Generator started in current-controlled operation.
  gen_stopped:
    severity: info
    display_name: Generator Stopped
    description: Generator stopped in current-controlled operation.
  low_battery_soc:
    severity: warning
    display_name: Low Battery State Of Charge
    description: Grid request due to low battery state of charge.
  grid_disconnect:
    severity: info
    display_name: Sufficient Battery State of Charge
    description: Release of grid disconnection due to sufficient battery state of charge.
  power_limit_exceed:
    severity: warning
    display_name: Power Limit Exceeded
    description: Grid request due to power limit being exceeded.
  power_limit_not_reached:
    severity: info
    display_name: Power Limit Not Reached
    description: Grid disconnection release as power limit not reached.
  manual_grid_request:
    severity: info
    display_name: Manual Grid Request
    description: Manual grid request.
  manual_grid_disconnect:
    severity: info
    display_name: Manual Grid Disconnection Release
    description: Manual grid disconnection release.
  blocking_of_gen:
    severity: warning
    display_name: Locking of Generator
    description: Blocking of generator due to too many interrupted start-ups.
  no_sync_with_gen:
    severity: warning
    display_name: Synchronization Not Executed
    description: Synchronization with the generator not successful.
  auto_freq_control_intervene:
    severity: warning
    display_name: Automatic Frequency Control Intervenes
    description: Automatic frequency control intervenes.
  auto_freq_control_end:
    severity: warning
    display_name: Automatic Frequency Control Ends
    description: Automatic frequency control ends.
  gen_operation_not_possible:
    severity: error
    display_name: Generator Operation Not Possible
    description: Generator operation not possible.
  invalid_grid_volt:
    severity: error
    display_name: Invalid Grid Voltage
    description: No valid grid voltage for requested grid operation.
  multicluster_box_fault:
    severity: error
    display_name: Multicluster-Box Malfunction
    description: A contactor in the Multicluster-Box is not functioning correctly.
    troubleshooting:
      - Check the Multicluster-Box contactors.
  overvoltage:
    severity: error
    display_name: Overvoltage at Connection AC1
    description: An overvoltage has occurred at connection AC1 of the Sunny Island.
    troubleshooting:
      - Check voltage at AC1 connection.
  overfreq:
    severity: error
    display_name: Overfrequency at Connection AC1
    description: An overfrequency has occurred at connection AC1 of the Sunny Island.
    troubleshooting:
      - Check frequency at AC1 connection.
  underfreq:
    severity: error
    display_name: Underfrequency at Connection AC1
    description: An underfrequency has occurred at connection AC1 of the Sunny Island.
    troubleshooting:
      - Check frequency at AC1 connection.
  volt_ac1_low:
    severity: error
    display_name: Too Low Voltage at Terminal AC1
    description: >
      Voltage at terminal AC1 of the Sunny Island is too low
      due to AC sources in the system.
    troubleshooting:
      - Check AC sources in the system.
  volt_ac1_undesired:
    severity: error
    display_name: Undesired Voltage at Terminal AC1
    description: >
      The Sunny Island has measured an undesired voltage at terminal AC1.
    troubleshooting:
      - Check for unexpected voltage at terminal AC1.
  open_tie_switch:
    severity: warning
    display_name: Open Tie Switch
    description: With open tie switch, AC voltage is applied.
  missing_line_conductor:
    severity: error
    display_name: Missing Line Conductor
    description: The line conductor of a Sunny Island is missing.
    troubleshooting:
      - Check line conductor connections.
  inverter_bridge_overcurrent:
    severity: error
    display_name: Overcurrent in Inverter Bridge
    description: >
      Too much current is flowing through the DC connection of a Sunny Island.
    troubleshooting:
      - Check DC connections.
      - Contact the Service.
  ocu_watchdog_triggered:
    severity: error
    display_name: OCU Watchdog Triggered
    description: >
      OCU watchdog was triggered (an error has occurred in the program sequence).
    troubleshooting:
      - Contact the Service.
  measurement_intereference:
    severity: error
    display_name: Measurement Interference
    description: >
      Voltage or current measurement interferences at external measurement
      point of the AC subdistribution (Multicluster-Box).
    troubleshooting:
      - Check measurement connections at the Multicluster-Box.
  device_fault:
    severity: error
    display_name: Device Fault
    description: A device fault has occurred.
    troubleshooting:
      - Contact the Service.
  incorrect_processor_volt:
    severity: error
    display_name: Incorrect Processor Voltage
    description: Processor voltage in the device is incorrect.
    troubleshooting:
      - Contact the Service.
  defective_volt_supply:
    severity: error
    display_name: Defective Voltage Supply in the Multicluster Box
    description: >
      15 V voltage supply or 24 V voltage supply in the Multicluster Box
      is defective.
    troubleshooting:
      - Contact the Service.
  overtemperature:
    severity: error
    display_name: Overtemperature
    description: >
      Temperature of the transformer or the heat sink in the Sunny Island
      is too high (due to overload or ambient temperature).
    troubleshooting:
      - Ensure that the inverter has sufficient ventilation.
      - Reduce the load if necessary.
  overload_volt_low:
    severity: error
    display_name: "Overload: Low Battery Voltage"
    description: Battery voltage is too low.
    troubleshooting:
      - Check battery voltage and charge state.
  overload_volt_high:
    severity: error
    display_name: "Overload: High Battery Voltage"
    description: Battery voltage is too high.
    troubleshooting:
      - Check battery voltage and charging parameters.
  excessive_current:
    severity: error
    display_name: Excessive Current
    description: >
      Excessive current has been applied to the internal transfer relay
      of the Sunny Island.
    troubleshooting:
      - Check load connections.
  high_power:
    severity: error
    display_name: The Power of the Loads is Too High
    description: The power of the loads is too high for the Sunny Island.
    troubleshooting:
      - Reduce the connected load.
  overload_5min_capacity:
    severity: error
    display_name: Overload of 5-minute Rated Capacity
    description: The device has been loaded over its 5-minute rated capacity.
    troubleshooting:
      - Reduce the connected load.
  overload_30min_capacity:
    severity: error
    display_name: Overload of 30-minute Rated Capacity
    description: The device has been loaded over its 30-minute rated capacity.
    troubleshooting:
      - Reduce the connected load.
  overload_shortterm_capacity:
    severity: error
    display_name: Overload of Short-Term Rated Capacity
    description: The device has been loaded over its rated short-term capacity.
    troubleshooting:
      - Reduce the connected load.
  fan_sensor_error:
    severity: error
    display_name: Permanent Fan Sensor Error
    description: >
      There is a short circuit or cable break at a temperature sensor
      of the device.
    troubleshooting:
      - Check temperature sensor connections.
      - Contact the Service.
  short_circuit_battery_temp_sensor:
    severity: error
    display_name: Short Circuit Battery Temperature Sensor
    description: Short circuit on battery temperature sensor.
    troubleshooting:
      - Check battery temperature sensor wiring.
  cable_break_battery_temp_sensor:
    severity: error
    display_name: Cable Break Battery Temperature Sensor
    description: Cable break, battery temperature sensor.
    troubleshooting:
      - Check battery temperature sensor wiring.
  defective_sd_memory_card:
    severity: error
    display_name: Defective SD Memory Card
    description: Micro SD card in the inverter is faulty.
    troubleshooting:
      - Replace the micro SD card.
  param_file_not_found_defective:
    severity: error
    display_name: Parameter File Not Found or Defective
    description: The update failed. Copy the parameter file to the correct folder again.
    troubleshooting:
      - Ensure the parameter file is in the correct folder.
  set_param:
    severity: warning
    display_name: Set Parameter
    description: The parameter change has been adopted.
  set_param_succeeded:
    severity: info
    display_name: Parameters Setting Successfully
    description: The parameter changes were successfully adopted.
  set_param_failed:
    severity: error
    display_name: Parameters Setting Failed
    description: Parameters could not be set using the memory card.
    troubleshooting:
      - Ensure thresholds of the parameters are complied with.
  update_failed:
    severity: error
    display_name: Update Failed
    description: Update the firmware again.
    troubleshooting:
      - Retry the firmware update.
  update_ok:
    severity: info
    display_name: Update Succeeded
    description: >
      The update file is suitable for this inverter and its components
      and is fully available for the next update step.
  read_sd_card:
    severity: info
    display_name: Reading SD Memory Card
    description: The inverter is currently reading the SD memory card.
  no_update_sd_card:
    severity: warning
    display_name: No New Update SD Memory Card
    description: >
      The micro SD memory card contains an update file that has already been used.
  no_update_file_found:
    severity: warning
    display_name: No Update File Found
    description: No update file found.
  update_file_copy_success:
    severity: info
    display_name: Update File Successfully Copied
    description: Update file was copied successfully to the inverter's internal memory.
  sd_card_protected:
    severity: info
    display_name: Memory Card Protected
    description: The memory card is full or write-protected.
  update_communication:
    severity: info
    display_name: Update Communication
    description: The inverter is updating the communication component.
  update_main_cpu:
    severity: info
    display_name: Update Main CPU
    description: The inverter is updating the inverter component.
  update_main_cpu_failed:
    severity: warning
    display_name: Update Main CPU Failed
    description: Update main CPU failed.
    troubleshooting:
      - Contact the Service.
  update_completed:
    severity: info
    display_name: Update Completed
    description: The inverter has successfully completed the update.
  firmware_update_success:
    severity: info
    display_name: Condition Test Successful
    description: >
      The testing of the update conditions was successful.
      The firmware update package is suitable for this inverter.
  condition_test_failed:
    severity: warning
    display_name: Condition Test Failed
    description: >
      The conditions of the update file used for the inverter settings
      are not fulfilled.
    troubleshooting:
      - Ensure the update file is suitable for this inverter.
  update_transport_started:
    severity: info
    display_name: Update Transport Started
    description: Update file is being copied.
  update_transport_success:
    severity: info
    display_name: Update Transport Succeeded
    description: Update file was copied successfully to the inverter's internal memory.
  update_transport_fail:
    severity: warning
    display_name: Update Transport Failed
    description: >
      Update file could not be copied to the inverter's internal memory.
    troubleshooting:
      - Retry the update.
      - For WLAN connection, improve the connection quality.
  update_bootloader:
    severity: info
    display_name: Update Bootloader
    description: The inverter is performing a bootloader update.
  update_bootloader_failed:
    severity: warning
    display_name: Update Bootloader Failed
    description: Bootloader update failed.
    troubleshooting:
      - Retry the update.
      - Contact the Service.
  communication_error_ipc:
    severity: error
    display_name: Communication Error IPC
    description: There is an error in the inverter.
    troubleshooting:
      - Contact the Service.
  internal_can_comm_missing:
    severity: error
    display_name: Internal CAN Communication Missing
    description: >
      Ensure that the terminators in the communication bus are attached,
      undamaged CAT5e cables are used for communication and they are
      plugged correctly.
    troubleshooting:
      - Check CAN bus terminators and cables.
  cluster_internal_comm_interrupt:
    severity: error
    display_name: Cluster-Internal Communication Interrupted
    description: Cluster-internal communication is interrupted.
    troubleshooting:
      - Check communication cables within the cluster.
  energy_meter_comm_fault:
    severity: error
    display_name: Faulty Communication with Energy Meter
    description: >
      Ensure that the optical probe is correctly installed and connected.
    troubleshooting:
      - Check energy meter probe connection.
  energy_meter_protocol_fault:
    severity: error
    display_name: Energy Meter Protocol Not Supported
    description: The energy meter protocol is not supported.
    troubleshooting:
      - Contact the Service.
  mc_box_comm_interrupted:
    severity: error
    display_name: Multicluster Box Communication Interrupted
    description: Communication with Multicluster Box is interrupted.
    troubleshooting:
      - Check communication cables to the Multicluster Box.
  cluster_can_fault:
    severity: error
    display_name: Faulty CAN Communication Within Cluster
    description: >
      Device-internal communication pulse is missing on at least
      one device.
    troubleshooting:
      - Check CAN communication within the cluster.
  meter_unit_comm_fault:
    severity: error
    display_name: Faulty Communication with Meter Unit
    description: The inverter is not receiving any data from the energy meter.
    troubleshooting:
      - Check energy meter connection and configuration.
  grid_power_meter_comm_fault:
    severity: error
    display_name: Faulty Communication with Grid Power Meter
    description: The inverter is not receiving any data from the energy meter.
    troubleshooting:
      - Check grid power meter connection.
  tie_switch_does_not_open:
    severity: error
    display_name: Section Switch Does Not Open
    description: Tie switch does not open.
    troubleshooting:
      - Check tie switch wiring.
  neutral_conduct_relay_fault:
    severity: error
    display_name: Neutral Conductor Relay Does Not Open
    description: Neutral conductor relay does not open.
    troubleshooting:
      - Contact the Service.
  transfer_relay_fault:
    severity: error
    display_name: Transfer Relay Does Not Open
    description: >
      Transfer relay does not open. A bypass switch may have bridged
      the internal transfer relay.
    troubleshooting:
      - Check for bypass switch bridging.
      - Contact the Service.
  mc_box_plausibility_check_fail:
    severity: error
    display_name: MC-BOX Plausibility Check Failed
    description: >
      Plausibility check on the contactors in the Multicluster-Box has failed.
    troubleshooting:
      - Check Multicluster-Box contactors.
  reduced_battery_charge_overheat:
    severity: warning
    display_name: Reduced Battery Charging Current Due to Overheating
    description: The inverter reduces the battery charging current due to overheating.
  comm_impaired:
    severity: error
    display_name: Communication Impaired
    description: The cause must be determined by the Service.
    troubleshooting:
      - Contact the Service.
  slave_fault_status:
    severity: error
    display_name: Slave is in Error State
    description: A slave has a fault status, cluster is stopped.
    troubleshooting:
      - Check the slave device status.
  cluster_config_error:
    severity: error
    display_name: Cluster Configuration Error
    description: >
      The addresses of the slaves in the cluster are incorrect.
    troubleshooting:
      - Change the addresses of the slaves in the cluster.
  master_comm_interrupt:
    severity: error
    display_name: No Message from Cluster Master
    description: Communication with the master is interrupted.
    troubleshooting:
      - Check communication with the cluster master.
  cannot_measure_cluster_volt:
    severity: error
    display_name: Main Cluster Voltage Fault
    description: Voltage of the main cluster cannot be measured.
    troubleshooting:
      - Check voltage measurement connections.
  box_encoding_fault:
    severity: error
    display_name: Box Encoding Fault
    description: >
      Box coding conflicts with software settings. Configuration of the
      Sunny Island inverters does not match the Multicluster-Box.
    troubleshooting:
      - Check Multicluster-Box configuration.
  short_circuit_on_load_side:
    severity: error
    display_name: Short Circuit on Load Side
    description: >
      Due to a short circuit on the load side, the supply voltage drops
      and can no longer be maintained.
    troubleshooting:
      - Check for short circuits on the load side.
  cluster_incorrect_country_standard:
    severity: warning
    display_name: Extension Cluster Incorrect Country Standard
    description: >
      At least in one extension cluster the Sunny Islands are set to another
      country's standard than the main cluster.
    troubleshooting:
      - Align the country standard across all clusters.
  cluster_another_firmware_version:
    severity: warning
    display_name: Extension Cluster Another Firmware Version
    description: >
      At least one extension cluster has different firmware version than
      the main cluster.
    troubleshooting:
      - Update the firmware on all clusters.
  setpoint_activated:
    severity: info
    display_name: Setpoint Spec. Activated
    description: "System control: Setpoint spec. activated."
  setpoint_deactivated:
    severity: info
    display_name: Setpoint Spec. Deactivated
    description: "System control: Setpoint spec. deactivated."
  saving_mode:
    severity: info
    display_name: Saving Mode
    description: Inverter switches to energy saving mode because battery range reached.
  sma_grid_guard_code_invalid:
    severity: warning
    display_name: SMA Grid Guard Code Invalid
    description: Enter the correct SMA Grid Guard code.
  grid_parameter_locked:
    severity: info
    display_name: Grid Parameter Locked
    description: >
      Changes to the grid-relevant parameters are now blocked.
      Log in using the SMA Grid Guard code to make changes.
  grid_parameters_unchanged:
    severity: info
    display_name: Grid Parameters Unchanged
    description: Grid parameters unchanged.
  reset_battery_management:
    severity: info
    display_name: Reset Battery Management Due to New Battery
    description: Reset battery management due to new battery.
  bms_timeout:
    severity: error
    display_name: Timeout of BMS Monitoring System
    description: The timeout monitoring system of the battery management was triggered.
    troubleshooting:
      - Check battery management system communication.
  temp_low_limit_undercut:
    severity: warning
    display_name: Lower Limit of Battery Temperature Undercut
    description: >
      Ensure that the ambient conditions of the battery manufacturer
      are complied with.
  temp_upper_limit_exceed:
    severity: warning
    display_name: Upper Limit of Battery Temperature Exceeded
    description: >
      Ensure that the ambient conditions of the battery manufacturer
      are complied with.
  emergency_charge:
    severity: warning
    display_name: Emergency Charge
    description: Emergency charge.
  battery_float_charge:
    severity: info
    display_name: Battery Float Charge
    description: Status change to battery float charge.
  battery_boost_charge:
    severity: info
    display_name: Battery Boost Charge
    description: Status change to battery boost charge.
  battery_full_charge:
    severity: info
    display_name: Battery Full Charge
    description: Status change to battery full charge.
  calibration_20_per_done:
    severity: info
    display_name: Recalibration of State of Charge to 20%
    description: >
      Sunny Island detected an unexpectedly sharp battery voltage drop
      during electric discharge, resulting in a recalibration of the
      state of charge to 20%.
  low_soh:
    severity: error
    display_name: Current Battery Capacity (SOH) is Below 70%
    description: >
      Please verify the plausibility of the error message or replace
      the battery if necessary.
    troubleshooting:
      - Verify battery capacity.
      - Replace the battery if necessary.
  recalibration_jump:
    severity: warning
    display_name: A 20% Recalibration Performed With A Jump More than 10%
    description: >
      A 20% recalibration of the battery state of charge has been performed
      with a jump of more than 10%. Please check the battery.
  battery_protection_mode_on:
    severity: warning
    display_name: Battery Protection Mode Activated
    description: >
      Disconnect the loads, start the generator, start the Sunny Island
      and charge the battery.
  battery_voltage_above_range:
    severity: warning
    display_name: Battery Voltage Is Above Measurement Range
    description: >
      Battery voltage in the Sunny Island is above the permissible
      measurement range.
  bms_not_configured:
    severity: warning
    display_name: Battery Management Not Configured
    description: >
      Start the installation assistant and configure a new system with
      external energy management.
  battery_voltage_below_range:
    severity: warning
    display_name: Battery Voltage Is Below Measurement Range
    description: >
      Battery voltage in the Sunny Island is below the permissible
      measurement range.
  battery_equalization_charge:
    severity: info
    display_name: Battery Equalization Charge
    description: Status change to battery equalization charge.
  deep_discharge_area:
    severity: error
    display_name: Deep Discharge Area or Deep Discharge Protection Area
    description: >
      The area for protection against deep discharge or the area for
      protection during deep discharge has been reached.
    troubleshooting:
      - Charge the battery immediately.
  saving_mode_slaves_single_phase:
    severity: info
    display_name: Energy Saving Mode of Slaves in Single-Phase Parallel Operation
    description: Energy saving mode of slaves in single-phase parallel operation.
  saving_mode_at_grid:
    severity: info
    display_name: Energy Saving Mode at Grid
    description: Energy saving mode at grid.
  saving_mode_start:
    severity: info
    display_name: Energy Saving Mode Start
    description: Energy saving mode start.
  saving_mode_stop:
    severity: info
    display_name: Energy Saving Mode Stop
    description: Energy saving mode stop.
  di_status_changed:
    severity: info
    display_name: Digital Input Status Changed
    description: Digital input has changed its status.
  parallel_grid_operation:
    severity: info
    display_name: Parallel Grid Operation
    description: Parallel grid operation.
  operation_status:
    severity: info
    display_name: Operation Status
    description: Operation status.
  cold_start_status:
    severity: info
    display_name: Cold Start Status
    description: Cold start status.
  startup_status:
    severity: info
    display_name: Startup Status
    description: Startup status.
  stop_status:
    severity: info
    display_name: Stop Status
    description: Stop status.
  restart_diagnosis_system:
    severity: info
    display_name: Restart Diagnosis System in Device
    description: Restart diagnosis system in device.
  gen_operation:
    severity: info
    display_name: Operation at Generator
    description: Operation at generator (at external point).
  feeding_network_op:
    severity: info
    display_name: Feeding Network Op
    description: Feeding network op (at external point).
  param_set_success:
    severity: info
    display_name: Parameter Set Successfully
    description: Parameter set successfully.
  param_set_fail:
    severity: warning
    display_name: Parameter Setting Failed
    description: >
      Ensure thresholds of the parameters are complied with and change
      the parameter again.
  old_time:
    severity: info
    display_name: Time Adjusted / Old Time
    description: Time adjusted / old time.
  new_time:
    severity: info
    display_name: Time Adjusted / New Time
    description: Time adjusted / new time.
  time_sync_failed:
    severity: warning
    display_name: Time Synchronization Failed
    description: Time synchronization failed.
  ntp_server_no_info:
    severity: warning
    display_name: No Time Information from NTP Server
    description: >
      Ensure that the NTP server was configured correctly and the inverter
      is integrated into a local network with Internet connection.
  invalid_time:
    severity: warning
    display_name: Invalid System Time
    description: Set the date and device time via the installation assistant.
  param_upload_success:
    severity: info
    display_name: Parameter Upload Successfully Performed
    description: The configuration file was loaded successfully.
  param_xx_set_fail1:
    severity: warning
    display_name: Parameter Setting Failed
    description: Setting of parameter failed. Device must be stopped first.
  param_xx_set_fail2:
    severity: warning
    display_name: Parameter Setting Failed
    description: Setting of parameter failed. Installation assistant must be started.
  network_busy:
    severity: warning
    display_name: Network Busy / Network Overloaded
    description: >
      Reduce the number of devices in the network.
      If necessary, increase the data query intervals.
  package_error_rate_changed:
    severity: warning
    display_name: Package Error Rate Changed
    description: >
      If the package error rate is high, the network is overloaded or the
      connection to the network switch or DHCP server (router) is disturbed.
  wifi_module_fault:
    severity: error
    display_name: Wi-Fi Module Fault
    description: The Wi-Fi module integrated in the inverter is defective.
    troubleshooting:
      - Contact the Service.
  shutdown_due_to_fault:
    severity: error
    display_name: Shutdown Due to Fault
    description: Shutdown due to fault.
    troubleshooting:
      - Check device status and error logs.
  automatic_start:
    severity: info
    display_name: Automatic Start
    description: Automatic start.
  manual_start:
    severity: info
    display_name: Manual Start
    description: Manual start (change-over from standby to op).
  manual_stop:
    severity: info
    display_name: Manual Stop
    description: Manual stop (change-over from op to standby).
  system_control_start:
    severity: info
    display_name: Start via System Control
    description: External start via system control.
  system_control_stop:
    severity: info
    display_name: Stop via System Control
    description: External stop via system control.
  self_consumpt_control_start:
    severity: info
    display_name: Self-Consumption Control Started
    description: >
      The battery is automatically charged or discharged depending on
      the purchased electricity or the grid feed-in.
  self_consumpt_control_stop:
    severity: info
    display_name: Self-Consumption Control Stopped
    description: >
      The automatic charging or discharging of the battery stopped
      due to an external control command.
  self_consumpt_only_charge:
    severity: info
    display_name: Only Charging Operation Self-Consumption Mode
    description: >
      The battery is charged only when increased self-consumption is active.
  charge_active_self_consumpt:
    severity: info
    display_name: Full or Equalization Charge with Active Increased Self-Consumption
    description: Full or equalization charge with active increased self-consumption.
  back_to_self_consumption:
    severity: info
    display_name: Increased Self-Consumption After Full/Equalization Charge
    description: >
      Switch back to increased self-consumption after completion of full
      or equalization charge.
  switch_off:
    severity: info
    display_name: Device Switches Off
    description: Device switches off.
  dynamic_act_pow_limit_start:
    severity: info
    display_name: Dynamic Active Power Limitation Started
    description: The inverter limits active power of the PV inverters to the set limit.
  dynamic_act_pow_limit_terminate:
    severity: info
    display_name: Dynamic Active Power Limitation Terminated
    description: The inverter terminated active power limitation of the PV inverters.
  current_sensor_defective:
    severity: error
    display_name: Defective Current Sensor
    description: >
      The current sensor is not connected, not available or defective.
    troubleshooting:
      - Check current sensor connection.
      - Contact the Service.
# yamllint enable rule:line-length

.cloud:
  category: batteries
  mobile_main_chart: battery_soc
  mobile_telemetry:
    - battery_soc
    - battery_voltage
    - ac_total_power
    - battery_current
  mobile_charts:
    - ac_total_power
    - battery_soc
    - battery_voltage
    - battery_current
    - battery_temperature
    - internal_temperature
